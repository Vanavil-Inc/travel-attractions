/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, Inject, PLATFORM_ID } from "@angular/core";
import { isPlatformBrowser } from "@angular/common";
import * as algoliasearchProxy from "algoliasearch/lite";
import instantsearch from "instantsearch.js/es";
import { VERSION } from "../version";
/** @type {?} */
const algoliasearch = algoliasearchProxy.default || algoliasearchProxy;
/** @typedef {?} */
var SearchRequest;
export { SearchRequest };
/** @typedef {?} */
var SearchForFacetValuesRequest;
export { SearchForFacetValuesRequest };
/** @typedef {?} */
var SearchParameters;
export { SearchParameters };
/**
 * @record
 */
export function SearchRequestParameters() { }
/** @type {?} */
SearchRequestParameters.prototype.query;
/**
 * @record
 */
export function SearchForFacetValuesRequestParameters() { }
/** @type {?} */
SearchForFacetValuesRequestParameters.prototype.facetQuery;
/** @type {?} */
SearchForFacetValuesRequestParameters.prototype.facetName;
/** @typedef {?} */
var GeoRectangle;
export { GeoRectangle };
/** @typedef {?} */
var GeoPolygon;
export { GeoPolygon };
/** @typedef {?} */
var SearchResponse;
export { SearchResponse };
/** @typedef {?} */
var Hit;
export { Hit };
/** @typedef {?} */
var SearchForFacetValuesResponse;
export { SearchForFacetValuesResponse };
/** @typedef {?} */
var SearchClient;
export { SearchClient };
/** @typedef {?} */
var InstantSearchConfig;
export { InstantSearchConfig };
export class InstantSearchInstance {
}
if (false) {
    /** @type {?} */
    InstantSearchInstance.prototype.start;
    /** @type {?} */
    InstantSearchInstance.prototype.addWidget;
    /** @type {?} */
    InstantSearchInstance.prototype.addWidgets;
    /** @type {?} */
    InstantSearchInstance.prototype.removeWidget;
    /** @type {?} */
    InstantSearchInstance.prototype.removeWidgets;
    /** @type {?} */
    InstantSearchInstance.prototype.on;
    /** @type {?} */
    InstantSearchInstance.prototype.removeListener;
    /** @type {?} */
    InstantSearchInstance.prototype.helper;
    /** @type {?} */
    InstantSearchInstance.prototype.refresh;
    /** @type {?} */
    InstantSearchInstance.prototype.dispose;
}
export class NgAisInstantSearch {
    /**
     * @param {?} platformId
     */
    constructor(platformId) {
        this.platformId = platformId;
        this.instanceName = "default";
        this.change = new EventEmitter();
        this.onRender = () => {
            this.change.emit({
                results: this.instantSearchInstance.helper.lastResults,
                state: this.instantSearchInstance.helper.state
            });
        };
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.createInstantSearchInstance(this.config);
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.instantSearchInstance.start();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.instantSearchInstance.removeListener("render", this.onRender);
        this.instantSearchInstance.dispose();
    }
    /**
     * @param {?} config
     * @return {?}
     */
    createInstantSearchInstance(config) {
        // add default searchParameters with highlighting config
        if (!config.searchParameters)
            config.searchParameters = {};
        Object.assign(config.searchParameters, {
            highlightPreTag: "__ais-highlight__",
            highlightPostTag: "__/ais-highlight__"
        });
        // remove URLSync widget if on SSR
        if (!isPlatformBrowser(this.platformId)) {
            if (typeof config.urlSync !== "undefined")
                delete config.urlSync;
            if (typeof config.routing !== "undefined")
                delete config.routing;
        }
        // custom algolia client agent
        if (!config.searchClient && !config.createAlgoliaClient) {
            /** @type {?} */
            const client = algoliasearch(config.appId, config.apiKey);
            client.addAlgoliaAgent(`angular-instantsearch ${VERSION}`);
            config.searchClient = client;
            config.appId = undefined;
            config.apiKey = undefined;
        }
        this.instantSearchInstance = instantsearch(config);
        this.instantSearchInstance.on("render", this.onRender);
    }
    /**
     * @param {?} widget
     * @return {?}
     */
    addWidget(widget) {
        this.instantSearchInstance.addWidget(widget);
    }
    /**
     * @param {?} widget
     * @return {?}
     */
    removeWidget(widget) {
        this.instantSearchInstance.removeWidget(widget);
    }
    /**
     * @return {?}
     */
    refresh() {
        this.instantSearchInstance.refresh();
    }
}
NgAisInstantSearch.decorators = [
    { type: Component, args: [{
                selector: "ais-instantsearch",
                template: `<ng-content></ng-content>`
            },] },
];
/** @nocollapse */
NgAisInstantSearch.ctorParameters = () => [
    { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
];
NgAisInstantSearch.propDecorators = {
    config: [{ type: Input }],
    instanceName: [{ type: Input }],
    change: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    NgAisInstantSearch.prototype.config;
    /** @type {?} */
    NgAisInstantSearch.prototype.instanceName;
    /** @type {?} */
    NgAisInstantSearch.prototype.change;
    /** @type {?} */
    NgAisInstantSearch.prototype.instantSearchInstance;
    /** @type {?} */
    NgAisInstantSearch.prototype.onRender;
    /** @type {?} */
    NgAisInstantSearch.prototype.platformId;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5zdGFudHNlYXJjaC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItaW5zdGFudHNlYXJjaC8iLCJzb3VyY2VzIjpbImluc3RhbnRzZWFyY2gvaW5zdGFudHNlYXJjaC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUVMLFNBQVMsRUFDVCxLQUFLLEVBR0wsTUFBTSxFQUNOLFlBQVksRUFDWixNQUFNLEVBQ04sV0FBVyxFQUNaLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRXBELE9BQU8sS0FBSyxrQkFBa0IsTUFBTSxvQkFBb0IsQ0FBQztBQUN6RCxPQUFPLGFBQWEsTUFBTSxxQkFBcUIsQ0FBQztBQUdoRCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sWUFBWSxDQUFDOztBQUVyQyxNQUFNLGFBQWEsR0FBRyxrQkFBa0IsQ0FBQyxPQUFPLElBQUksa0JBQWtCLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXVLdkUsTUFBTTtDQW9CTDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFNRCxNQUFNOzs7O0lBWUosWUFBeUMsVUFBa0I7UUFBbEIsZUFBVSxHQUFWLFVBQVUsQ0FBUTs0QkFWcEIsU0FBUztzQkFHRyxJQUFJLFlBQVksRUFHL0Q7d0JBMkRPLEdBQUcsRUFBRTtZQUNkLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO2dCQUNmLE9BQU8sRUFBRSxJQUFJLENBQUMscUJBQXFCLENBQUMsTUFBTSxDQUFDLFdBQVc7Z0JBQ3RELEtBQUssRUFBRSxJQUFJLENBQUMscUJBQXFCLENBQUMsTUFBTSxDQUFDLEtBQUs7YUFDL0MsQ0FBQyxDQUFDO1NBQ0o7S0E1RDhEOzs7O0lBRXhELFFBQVE7UUFDYixJQUFJLENBQUMsMkJBQTJCLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDOzs7OztJQUd6QyxlQUFlO1FBQ3BCLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLEVBQUUsQ0FBQzs7Ozs7SUFHOUIsV0FBVztRQUNoQixJQUFJLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbkUsSUFBSSxDQUFDLHFCQUFxQixDQUFDLE9BQU8sRUFBRSxDQUFDOzs7Ozs7SUFHaEMsMkJBQTJCLENBQUMsTUFBMkI7O1FBRTVELElBQUksQ0FBQyxNQUFNLENBQUMsZ0JBQWdCO1lBQUUsTUFBTSxDQUFDLGdCQUFnQixHQUFHLEVBQUUsQ0FBQztRQUMzRCxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRTtZQUNyQyxlQUFlLEVBQUUsbUJBQW1CO1lBQ3BDLGdCQUFnQixFQUFFLG9CQUFvQjtTQUN2QyxDQUFDLENBQUM7O1FBR0gsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRTtZQUN2QyxJQUFJLE9BQU8sTUFBTSxDQUFDLE9BQU8sS0FBSyxXQUFXO2dCQUFFLE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQztZQUNqRSxJQUFJLE9BQU8sTUFBTSxDQUFDLE9BQU8sS0FBSyxXQUFXO2dCQUFFLE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQztTQUNsRTs7UUFHRCxJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksSUFBSSxDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsRUFBRTs7WUFDdkQsTUFBTSxNQUFNLEdBQUcsYUFBYSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzFELE1BQU0sQ0FBQyxlQUFlLENBQUMseUJBQXlCLE9BQU8sRUFBRSxDQUFDLENBQUM7WUFFM0QsTUFBTSxDQUFDLFlBQVksR0FBRyxNQUFNLENBQUM7WUFDN0IsTUFBTSxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUM7WUFDekIsTUFBTSxDQUFDLE1BQU0sR0FBRyxTQUFTLENBQUM7U0FDM0I7UUFFRCxJQUFJLENBQUMscUJBQXFCLEdBQUcsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ25ELElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQzs7Ozs7O0lBR2xELFNBQVMsQ0FBQyxNQUFjO1FBQzdCLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7Ozs7OztJQUd4QyxZQUFZLENBQUMsTUFBYztRQUNoQyxJQUFJLENBQUMscUJBQXFCLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDOzs7OztJQUczQyxPQUFPO1FBQ1osSUFBSSxDQUFDLHFCQUFxQixDQUFDLE9BQU8sRUFBRSxDQUFDOzs7O1lBcEV4QyxTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLG1CQUFtQjtnQkFDN0IsUUFBUSxFQUFFLDJCQUEyQjthQUN0Qzs7OztZQWFzRCxNQUFNLHVCQUE5QyxNQUFNLFNBQUMsV0FBVzs7O3FCQVg5QixLQUFLOzJCQUNMLEtBQUs7cUJBRUwsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEFmdGVyVmlld0luaXQsXG4gIENvbXBvbmVudCxcbiAgSW5wdXQsXG4gIE9uSW5pdCxcbiAgT25EZXN0cm95LFxuICBPdXRwdXQsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5qZWN0LFxuICBQTEFURk9STV9JRFxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHsgaXNQbGF0Zm9ybUJyb3dzZXIgfSBmcm9tIFwiQGFuZ3VsYXIvY29tbW9uXCI7XG5cbmltcG9ydCAqIGFzIGFsZ29saWFzZWFyY2hQcm94eSBmcm9tIFwiYWxnb2xpYXNlYXJjaC9saXRlXCI7XG5pbXBvcnQgaW5zdGFudHNlYXJjaCBmcm9tIFwiaW5zdGFudHNlYXJjaC5qcy9lc1wiO1xuXG5pbXBvcnQgeyBXaWRnZXQgfSBmcm9tIFwiLi4vYmFzZS13aWRnZXRcIjtcbmltcG9ydCB7IFZFUlNJT04gfSBmcm9tIFwiLi4vdmVyc2lvblwiO1xuXG5jb25zdCBhbGdvbGlhc2VhcmNoID0gYWxnb2xpYXNlYXJjaFByb3h5LmRlZmF1bHQgfHwgYWxnb2xpYXNlYXJjaFByb3h5O1xuXG5leHBvcnQgdHlwZSBTZWFyY2hSZXF1ZXN0ID0ge1xuICBpbmRleE5hbWU6IHN0cmluZztcbiAgcGFyYW1zOiBTZWFyY2hSZXF1ZXN0UGFyYW1ldGVycztcbn07XG5cbmV4cG9ydCB0eXBlIFNlYXJjaEZvckZhY2V0VmFsdWVzUmVxdWVzdCA9IHtcbiAgaW5kZXhOYW1lOiBzdHJpbmc7XG4gIHBhcmFtczogU2VhcmNoRm9yRmFjZXRWYWx1ZXNSZXF1ZXN0UGFyYW1ldGVycztcbn07XG5cbi8vIERvY3VtZW50YXRpb246IGh0dHBzOi8vd3d3LmFsZ29saWEuY29tL2RvYy9hcGktcmVmZXJlbmNlL3NlYXJjaC1hcGktcGFyYW1ldGVycy9cbmV4cG9ydCB0eXBlIFNlYXJjaFBhcmFtZXRlcnMgPSB7XG4gIC8vIEF0dHJpYnV0ZXNcbiAgYXR0cmlidXRlc1RvUmV0cmlldmU/OiBzdHJpbmdbXTtcbiAgcmVzdHJpY3RTZWFyY2hhYmxlQXR0cmlidXRlcz86IHN0cmluZ1tdO1xuXG4gIC8vIEZpbHRlcmluZ1xuICBmaWx0ZXJzPzogc3RyaW5nO1xuICBmYWNldEZpbHRlcnM/OiBzdHJpbmdbXTtcbiAgb3B0aW9uYWxGaWx0ZXJzPzogc3RyaW5nW107XG4gIG51bWVyaWNGaWx0ZXJzPzogc3RyaW5nW107XG4gIHN1bU9yRmlsdGVyc1Njb3Jlcz86IGJvb2xlYW47XG5cbiAgLy8gRmFjZXRpbmdcbiAgZmFjZXRzPzogc3RyaW5nW107XG4gIG1heFZhbHVlc1BlckZhY2V0PzogbnVtYmVyO1xuICBmYWNldGluZ0FmdGVyRGlzdGluY3Q/OiBib29sZWFuO1xuICBzb3J0RmFjZXRWYWx1ZXNCeT86IHN0cmluZztcblxuICAvLyBIaWdobGlnaHRpbmcgLyBTbmlwcGV0aW5nXG4gIGF0dHJpYnV0ZXNUb0hpZ2hsaWdodD86IHN0cmluZ1tdO1xuICBhdHRyaWJ1dGVzVG9TbmlwcGV0Pzogc3RyaW5nW107XG4gIGhpZ2hsaWdodFByZVRhZz86IHN0cmluZztcbiAgaGlnaGxpZ2h0UG9zdFRhZz86IHN0cmluZztcbiAgc25pcHBldEVsbGlwc2lzVGV4dD86IHN0cmluZztcbiAgcmVzdHJpY3RIaWdobGlnaHRBbmRTbmlwcGV0QXJyYXlzPzogYm9vbGVhbjtcblxuICAvLyBQYWdpbmF0aW9uXG4gIHBhZ2U/OiBudW1iZXI7XG4gIGhpdHNQZXJQYWdlPzogbnVtYmVyO1xuICBvZmZzZXQ/OiBudW1iZXI7XG4gIGxlbmd0aD86IG51bWJlcjtcblxuICAvLyBUeXBvc1xuICBtaW5Xb3JkU2l6ZWZvcjFUeXBvPzogbnVtYmVyO1xuICBtaW5Xb3JkU2l6ZWZvcjJUeXBvcz86IG51bWJlcjtcbiAgdHlwb1RvbGVyYW5jZT86IHN0cmluZyB8IGJvb2xlYW47XG4gIGFsbG93VHlwb3NPbk51bWVyaWNUb2tlbnM/OiBib29sZWFuO1xuICBpZ25vcmVQbHVyYWxzPzogYm9vbGVhbiB8IHN0cmluZ1tdO1xuICBkaXNhYmxlVHlwb1RvbGVyYW5jZU9uQXR0cmlidXRlcz86IHN0cmluZ1tdO1xuXG4gIC8vIEdlby1TZWFyY2hcbiAgYXJvdW5kTGF0TG5nPzogc3RyaW5nO1xuICBhcm91bmRMYXRMbmdWaWFJUD86IGJvb2xlYW47XG4gIGFyb3VuZFJhZGl1cz86IG51bWJlciB8IFwiYWxsXCI7XG4gIGFyb3VuZFByZWNpc2lvbj86IG51bWJlcjtcbiAgbWluaW11bUFyb3VuZFJhZGl1cz86IG51bWJlcjtcbiAgaW5zaWRlQm91bmRpbmdCb3g/OiBHZW9SZWN0YW5nbGUgfCBHZW9SZWN0YW5nbGVbXTtcbiAgaW5zaWRlUG9seWdvbj86IEdlb1BvbHlnb24gfCBHZW9Qb2x5Z29uW107XG5cbiAgLy8gUXVlcnkgU3RyYXRlZ3lcbiAgcXVlcnlUeXBlPzogc3RyaW5nO1xuICByZW1vdmVXb3Jkc0lmTm9SZXN1bHRzPzogc3RyaW5nO1xuICBhZHZhbmNlZFN5bnRheD86IGJvb2xlYW47XG4gIG9wdGlvbmFsV29yZHM/OiBzdHJpbmcgfCBzdHJpbmdbXTtcbiAgcmVtb3ZlU3RvcFdvcmRzPzogYm9vbGVhbiB8IHN0cmluZ1tdO1xuICBkaXNhYmxlRXhhY3RPbkF0dHJpYnV0ZXM/OiBzdHJpbmdbXTtcbiAgZXhhY3RPblNpbmdsZVdvcmRRdWVyeT86IHN0cmluZztcbiAgYWx0ZXJuYXRpdmVzQXNFeGFjdD86IHN0cmluZ1tdO1xuXG4gIC8vIFF1ZXJ5IFJ1bGVzXG4gIGVuYWJsZVJ1bGVzPzogYm9vbGVhbjtcbiAgcnVsZUNvbnRleHRzPzogc3RyaW5nW107XG5cbiAgLy8gQWR2YW5jZWRcbiAgbWluUHJveGltaXR5PzogbnVtYmVyO1xuICByZXNwb25zZUZpZWxkcz86IHN0cmluZ1tdO1xuICBtYXhGYWNldEhpdHM/OiBudW1iZXI7XG4gIHBlcmNlbnRpbGVDb21wdXRhdGlvbj86IGJvb2xlYW47XG4gIGRpc3RpbmN0PzogbnVtYmVyIHwgYm9vbGVhbjtcbiAgZ2V0UmFua2luZ0luZm8/OiBib29sZWFuO1xuICBjbGlja0FuYWx5dGljcz86IGJvb2xlYW47XG4gIGFuYWx5dGljcz86IGJvb2xlYW47XG4gIGFuYWx5dGljc1RhZ3M/OiBzdHJpbmdbXTtcbiAgc3lub255bXM/OiBib29sZWFuO1xuICByZXBsYWNlU3lub255bXNJbkhpZ2hsaWdodD86IGJvb2xlYW47XG59O1xuXG5leHBvcnQgaW50ZXJmYWNlIFNlYXJjaFJlcXVlc3RQYXJhbWV0ZXJzIGV4dGVuZHMgU2VhcmNoUGFyYW1ldGVycyB7XG4gIHF1ZXJ5OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VhcmNoRm9yRmFjZXRWYWx1ZXNSZXF1ZXN0UGFyYW1ldGVyc1xuICBleHRlbmRzIFNlYXJjaFBhcmFtZXRlcnMge1xuICBmYWNldFF1ZXJ5OiBzdHJpbmc7XG4gIGZhY2V0TmFtZTogc3RyaW5nO1xufVxuXG5leHBvcnQgdHlwZSBHZW9SZWN0YW5nbGUgPSBbbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyXTtcbmV4cG9ydCB0eXBlIEdlb1BvbHlnb24gPSBbbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlcl07XG5cbi8vIERvY3VtZW50YXRpb246IGh0dHBzOi8vd3d3LmFsZ29saWEuY29tL2RvYy9yZXN0LWFwaS9zZWFyY2gvP2xhbmd1YWdlPWphdmFzY3JpcHQjc2VhcmNoLW11bHRpcGxlLWluZGV4ZXNcbmV4cG9ydCB0eXBlIFNlYXJjaFJlc3BvbnNlID0ge1xuICBoaXRzOiBIaXRbXTtcbiAgcGFnZT86IG51bWJlcjtcbiAgbmJIaXRzPzogbnVtYmVyO1xuICBuYlBhZ2VzPzogbnVtYmVyO1xuICBoaXRzUGVyUGFnZT86IG51bWJlcjtcbiAgcHJvY2Vzc2luZ1RpbWVNUz86IG51bWJlcjtcbiAgcXVlcnk/OiBzdHJpbmc7XG4gIHBhcmFtcz86IHN0cmluZztcbiAgaW5kZXg/OiBzdHJpbmc7XG59O1xuXG5leHBvcnQgdHlwZSBIaXQgPSB7XG4gIF9oaWdobGlnaHRSZXN1bHQ/OiBvYmplY3Q7XG59O1xuXG4vLyBEb2N1bWVudGF0aW9uOiBodHRwczovL3d3dy5hbGdvbGlhLmNvbS9kb2MvcmVzdC1hcGkvc2VhcmNoLz9sYW5ndWFnZT1qYXZhc2NyaXB0I3NlYXJjaC1mb3ItZmFjZXQtdmFsdWVzXG5leHBvcnQgdHlwZSBTZWFyY2hGb3JGYWNldFZhbHVlc1Jlc3BvbnNlID0ge1xuICB2YWx1ZTogc3RyaW5nO1xuICBoaWdobGlnaHRlZD86IHN0cmluZztcbiAgY291bnQ/OiBudW1iZXI7XG59O1xuXG5leHBvcnQgdHlwZSBTZWFyY2hDbGllbnQgPSB7XG4gIHNlYXJjaDogKHJlcXVlc3RzOiBTZWFyY2hSZXF1ZXN0W10pID0+IFByb21pc2U8eyByZXN1bHRzOiBTZWFyY2hSZXNwb25zZVtdIH0+O1xuICBzZWFyY2hGb3JGYWNldFZhbHVlcz86IChcbiAgICByZXF1ZXN0czogU2VhcmNoRm9yRmFjZXRWYWx1ZXNSZXF1ZXN0W11cbiAgKSA9PiBQcm9taXNlPHsgZmFjZXRIaXRzOiBTZWFyY2hGb3JGYWNldFZhbHVlc1Jlc3BvbnNlW10gfT47XG59O1xuXG5leHBvcnQgdHlwZSBJbnN0YW50U2VhcmNoQ29uZmlnID0ge1xuICBhcHBJZD86IHN0cmluZztcbiAgYXBpS2V5Pzogc3RyaW5nO1xuICBpbmRleE5hbWU6IHN0cmluZztcblxuICBudW1iZXJMb2NhbGU/OiBzdHJpbmc7XG4gIHNlYXJjaEZ1bmN0aW9uPzogKCkgPT4gdm9pZDtcbiAgY3JlYXRlQWxnb2xpYUNsaWVudD86IChcbiAgICBhbGdvbGlhc2VhcmNoOiBGdW5jdGlvbixcbiAgICBhcHBJZDogc3RyaW5nLFxuICAgIGFwaUtleTogc3RyaW5nXG4gICkgPT4gb2JqZWN0O1xuICBzZWFyY2hDbGllbnQ/OiBTZWFyY2hDbGllbnQ7XG4gIHNlYXJjaFBhcmFtZXRlcnM/OiBTZWFyY2hQYXJhbWV0ZXJzIHwgdm9pZDtcbiAgdXJsU3luYz86XG4gICAgfCBib29sZWFuXG4gICAgfCB7XG4gICAgICAgIG1hcHBpbmc/OiBvYmplY3Q7XG4gICAgICAgIHRocmVzaG9sZD86IG51bWJlcjtcbiAgICAgICAgdHJhY2tlZFBhcmFtZXRlcnM/OiBzdHJpbmdbXTtcbiAgICAgICAgdXNlSGFzaD86IGJvb2xlYW47XG4gICAgICAgIGdldEhpc3RvcnlTdGF0ZT86ICgpID0+IG9iamVjdDtcbiAgICAgIH07XG4gIHJvdXRpbmc/OlxuICAgIHwgYm9vbGVhblxuICAgIHwge1xuICAgICAgICBzdGF0ZU1hcHBpbmc/OiB7XG4gICAgICAgICAgc3RhdGVUb1JvdXRlKG9iamVjdCk6IG9iamVjdDtcbiAgICAgICAgICByb3V0ZVRvU3RhdGUob2JqZWN0KTogb2JqZWN0O1xuICAgICAgICB9O1xuICAgICAgfTtcbn07XG5cbmV4cG9ydCBjbGFzcyBJbnN0YW50U2VhcmNoSW5zdGFuY2Uge1xuICBwdWJsaWMgc3RhcnQ6ICgpID0+IHZvaWQ7XG5cbiAgcHVibGljIGFkZFdpZGdldDogKHdpZGdldDogV2lkZ2V0KSA9PiB2b2lkO1xuICBwdWJsaWMgYWRkV2lkZ2V0czogKHdpZGdldHM6IFdpZGdldFtdKSA9PiB2b2lkO1xuXG4gIHB1YmxpYyByZW1vdmVXaWRnZXQ6ICh3aWRnZXQ6IFdpZGdldCkgPT4gdm9pZDtcbiAgcHVibGljIHJlbW92ZVdpZGdldHM6ICh3aWRnZXRzOiBXaWRnZXRbXSkgPT4gdm9pZDtcblxuICAvLyBFdmVudEVtbWl0ZXJcbiAgcHVibGljIG9uOiAoZXZlbnROYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiBGdW5jdGlvbikgPT4gdm9pZDtcbiAgcHVibGljIHJlbW92ZUxpc3RlbmVyOiAoZXZlbnROYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiBGdW5jdGlvbikgPT4gdm9pZDtcblxuICBwdWJsaWMgaGVscGVyOiB7XG4gICAgbGFzdFJlc3VsdHM6IE9iamVjdDtcbiAgICBzdGF0ZTogT2JqZWN0O1xuICB9O1xuXG4gIHB1YmxpYyByZWZyZXNoOiAoKSA9PiB2b2lkO1xuICBwdWJsaWMgZGlzcG9zZTogKCkgPT4gdm9pZDtcbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiBcImFpcy1pbnN0YW50c2VhcmNoXCIsXG4gIHRlbXBsYXRlOiBgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PmBcbn0pXG5leHBvcnQgY2xhc3MgTmdBaXNJbnN0YW50U2VhcmNoIGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25Jbml0LCBPbkRlc3Ryb3kge1xuICBASW5wdXQoKSBwdWJsaWMgY29uZmlnOiBJbnN0YW50U2VhcmNoQ29uZmlnO1xuICBASW5wdXQoKSBwdWJsaWMgaW5zdGFuY2VOYW1lOiBzdHJpbmcgPSBcImRlZmF1bHRcIjtcblxuICBAT3V0cHV0KClcbiAgY2hhbmdlOiBFdmVudEVtaXR0ZXI8eyByZXN1bHRzOiB7fTsgc3RhdGU6IHt9IH0+ID0gbmV3IEV2ZW50RW1pdHRlcjx7XG4gICAgcmVzdWx0czoge307XG4gICAgc3RhdGU6IHt9O1xuICB9PigpO1xuXG4gIHB1YmxpYyBpbnN0YW50U2VhcmNoSW5zdGFuY2U6IEluc3RhbnRTZWFyY2hJbnN0YW5jZTtcblxuICBjb25zdHJ1Y3RvcihASW5qZWN0KFBMQVRGT1JNX0lEKSBwcml2YXRlIHBsYXRmb3JtSWQ6IE9iamVjdCkge31cblxuICBwdWJsaWMgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5jcmVhdGVJbnN0YW50U2VhcmNoSW5zdGFuY2UodGhpcy5jb25maWcpO1xuICB9XG5cbiAgcHVibGljIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLmluc3RhbnRTZWFyY2hJbnN0YW5jZS5zdGFydCgpO1xuICB9XG5cbiAgcHVibGljIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMuaW5zdGFudFNlYXJjaEluc3RhbmNlLnJlbW92ZUxpc3RlbmVyKFwicmVuZGVyXCIsIHRoaXMub25SZW5kZXIpO1xuICAgIHRoaXMuaW5zdGFudFNlYXJjaEluc3RhbmNlLmRpc3Bvc2UoKTtcbiAgfVxuXG4gIHB1YmxpYyBjcmVhdGVJbnN0YW50U2VhcmNoSW5zdGFuY2UoY29uZmlnOiBJbnN0YW50U2VhcmNoQ29uZmlnKSB7XG4gICAgLy8gYWRkIGRlZmF1bHQgc2VhcmNoUGFyYW1ldGVycyB3aXRoIGhpZ2hsaWdodGluZyBjb25maWdcbiAgICBpZiAoIWNvbmZpZy5zZWFyY2hQYXJhbWV0ZXJzKSBjb25maWcuc2VhcmNoUGFyYW1ldGVycyA9IHt9O1xuICAgIE9iamVjdC5hc3NpZ24oY29uZmlnLnNlYXJjaFBhcmFtZXRlcnMsIHtcbiAgICAgIGhpZ2hsaWdodFByZVRhZzogXCJfX2Fpcy1oaWdobGlnaHRfX1wiLFxuICAgICAgaGlnaGxpZ2h0UG9zdFRhZzogXCJfXy9haXMtaGlnaGxpZ2h0X19cIlxuICAgIH0pO1xuXG4gICAgLy8gcmVtb3ZlIFVSTFN5bmMgd2lkZ2V0IGlmIG9uIFNTUlxuICAgIGlmICghaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybUlkKSkge1xuICAgICAgaWYgKHR5cGVvZiBjb25maWcudXJsU3luYyAhPT0gXCJ1bmRlZmluZWRcIikgZGVsZXRlIGNvbmZpZy51cmxTeW5jO1xuICAgICAgaWYgKHR5cGVvZiBjb25maWcucm91dGluZyAhPT0gXCJ1bmRlZmluZWRcIikgZGVsZXRlIGNvbmZpZy5yb3V0aW5nO1xuICAgIH1cblxuICAgIC8vIGN1c3RvbSBhbGdvbGlhIGNsaWVudCBhZ2VudFxuICAgIGlmICghY29uZmlnLnNlYXJjaENsaWVudCAmJiAhY29uZmlnLmNyZWF0ZUFsZ29saWFDbGllbnQpIHtcbiAgICAgIGNvbnN0IGNsaWVudCA9IGFsZ29saWFzZWFyY2goY29uZmlnLmFwcElkLCBjb25maWcuYXBpS2V5KTtcbiAgICAgIGNsaWVudC5hZGRBbGdvbGlhQWdlbnQoYGFuZ3VsYXItaW5zdGFudHNlYXJjaCAke1ZFUlNJT059YCk7XG5cbiAgICAgIGNvbmZpZy5zZWFyY2hDbGllbnQgPSBjbGllbnQ7XG4gICAgICBjb25maWcuYXBwSWQgPSB1bmRlZmluZWQ7XG4gICAgICBjb25maWcuYXBpS2V5ID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHRoaXMuaW5zdGFudFNlYXJjaEluc3RhbmNlID0gaW5zdGFudHNlYXJjaChjb25maWcpO1xuICAgIHRoaXMuaW5zdGFudFNlYXJjaEluc3RhbmNlLm9uKFwicmVuZGVyXCIsIHRoaXMub25SZW5kZXIpO1xuICB9XG5cbiAgcHVibGljIGFkZFdpZGdldCh3aWRnZXQ6IFdpZGdldCkge1xuICAgIHRoaXMuaW5zdGFudFNlYXJjaEluc3RhbmNlLmFkZFdpZGdldCh3aWRnZXQpO1xuICB9XG5cbiAgcHVibGljIHJlbW92ZVdpZGdldCh3aWRnZXQ6IFdpZGdldCkge1xuICAgIHRoaXMuaW5zdGFudFNlYXJjaEluc3RhbmNlLnJlbW92ZVdpZGdldCh3aWRnZXQpO1xuICB9XG5cbiAgcHVibGljIHJlZnJlc2goKSB7XG4gICAgdGhpcy5pbnN0YW50U2VhcmNoSW5zdGFuY2UucmVmcmVzaCgpO1xuICB9XG5cbiAgb25SZW5kZXIgPSAoKSA9PiB7XG4gICAgdGhpcy5jaGFuZ2UuZW1pdCh7XG4gICAgICByZXN1bHRzOiB0aGlzLmluc3RhbnRTZWFyY2hJbnN0YW5jZS5oZWxwZXIubGFzdFJlc3VsdHMsXG4gICAgICBzdGF0ZTogdGhpcy5pbnN0YW50U2VhcmNoSW5zdGFuY2UuaGVscGVyLnN0YXRlXG4gICAgfSk7XG4gIH07XG59XG4iXX0=